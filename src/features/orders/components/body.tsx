// import Image from "next/image";

// const OrderList = () => {
//   return (
//     <>
//       <div className="flex flex-col py-2 gap-7">
//         <div className="w-2xl h-50 bg-[#fdfcff] rounded-2xl mx-auto border  border-gray-200 ">
//           <div className="grid grid-cols-2 px-4 py-6">
//             <div className="w-3xs h-40 bg-blue-400 col-start-1 col-end-1 rounded-md overflow-hidden relative">
//               <Image
//                 src="https://res.cloudinary.com/drarpvqyo/image/upload/v1755856573/Westin_Image_Room_ddrlyb.webp"
//                 alt="Westin room"
//                 fill
//                 className="object-cover"
//               ></Image>
//             </div>
//             <div className="w-xs h-30 col-start-2 col-end-2 ml-[-45px]">
//               <div>
//                 <p className="text-xs text-gray-500">
//                   ID ae78043b-2249-42b6-86d9-60219a94cdc7
//                 </p>
//               </div>
//               <div className="mt-2 space-y-2">
//                 <div className="flex justify-between ">
//                   <p className="text-sm">Payment method</p>
//                   <span className="text-sm font-semibold">Manual transfer</span>
//                 </div>
//                 <div className="flex justify-between">
//                   <p className="text-sm ">Date</p>
//                   <span className="text-sm font-semibold">
//                     22/8/25 - 28/8/25
//                   </span>
//                 </div>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Location</p>
//                   <span className="text-sm font-semibold">Jakarta</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Price</p>
//                   <span className="text-sm font-semibold">Rp 2.000.000,00</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm font-extralight">see more details</p>
//                   <span className="text-sm text-center bg-green-600 w-22 h-5 rounded-md">
//                     Paid
//                   </span>
//                 </p>
//               </div>
//             </div>
//           </div>
//         </div>
//         <div className="w-2xl h-50 bg-[#fdfcff] rounded-2xl mx-auto border border-gray-200 ">
//           <div className="grid grid-cols-2 px-4 py-6">
//             <div className="w-3xs h-40 bg-blue-400 col-start-1 col-end-1 rounded-md overflow-hidden relative">
//               <Image
//                 src="https://res.cloudinary.com/drarpvqyo/image/upload/v1755856573/Westin_Image_Room_ddrlyb.webp"
//                 alt="Westin room"
//                 fill
//                 className="object-cover"
//               ></Image>
//             </div>
//             <div className="w-xs h-30 col-start-2 col-end-2 ml-[-45px]">
//               <div>
//                 <p className="text-xs text-gray-500">
//                   ID ae78043b-2249-42b6-86d9-60219a94cdc7
//                 </p>
//               </div>
//               <div className="mt-2 space-y-2">
//                 <div className="flex justify-between ">
//                   <p className="text-sm">Payment method</p>
//                   <span className="text-sm font-semibold">Manual transfer</span>
//                 </div>
//                 <div className="flex justify-between">
//                   <p className="text-sm ">Date</p>
//                   <span className="text-sm font-semibold">
//                     22/8/25 - 28/8/25
//                   </span>
//                 </div>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Location</p>
//                   <span className="text-sm font-semibold">Jakarta</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Price</p>
//                   <span className="text-sm font-semibold">Rp 2.000.000,00</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm font-extralight">see more details</p>
//                   <span className="text-sm text-center bg-green-600 w-22 h-5 rounded-md">
//                     Paid
//                   </span>
//                 </p>
//               </div>
//             </div>
//           </div>
//         </div>
//         <div className="w-2xl h-50 bg-[#fdfcff] rounded-2xl mx-auto border border-gray-200 ">
//           <div className="grid grid-cols-2 px-4 py-6">
//             <div className="w-3xs h-40 bg-blue-400 col-start-1 col-end-1 rounded-md overflow-hidden relative">
//               <Image
//                 src="https://res.cloudinary.com/drarpvqyo/image/upload/v1755856573/Westin_Image_Room_ddrlyb.webp"
//                 alt="Westin room"
//                 fill
//                 className="object-cover"
//               ></Image>
//             </div>
//             <div className="w-xs h-30 col-start-2 col-end-2 ml-[-45px]">
//               <div>
//                 <p className="text-xs text-gray-500">
//                   ID ae78043b-2249-42b6-86d9-60219a94cdc7
//                 </p>
//               </div>
//               <div className="mt-2 space-y-2">
//                 <div className="flex justify-between ">
//                   <p className="text-sm">Payment method</p>
//                   <span className="text-sm font-semibold">Manual transfer</span>
//                 </div>
//                 <div className="flex justify-between">
//                   <p className="text-sm ">Date</p>
//                   <span className="text-sm font-semibold">
//                     22/8/25 - 28/8/25
//                   </span>
//                 </div>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Location</p>
//                   <span className="text-sm font-semibold">Jakarta</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Price</p>
//                   <span className="text-sm font-semibold">Rp 2.000.000,00</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm font-extralight">see more details</p>
//                   <span className="text-sm text-center bg-green-600 w-22 h-5 rounded-md">
//                     Paid
//                   </span>
//                 </p>
//               </div>
//             </div>
//           </div>
//         </div>
//         <div className="w-2xl h-50 bg-[#fdfcff] rounded-2xl mx-auto border border-gray-200">
//           <div className="grid grid-cols-2 px-4 py-6">
//             <div className="w-3xs h-40 bg-blue-400 col-start-1 col-end-1 rounded-md overflow-hidden relative">
//               <Image
//                 src="https://res.cloudinary.com/drarpvqyo/image/upload/v1755856573/Westin_Image_Room_ddrlyb.webp"
//                 alt="Westin room"
//                 fill
//                 className="object-cover"
//               ></Image>
//             </div>
//             <div className="w-xs h-30 col-start-2 col-end-2 ml-[-45px]">
//               <div>
//                 <p className="text-xs text-gray-500">
//                   ID ae78043b-2249-42b6-86d9-60219a94cdc7
//                 </p>
//               </div>
//               <div className="mt-2 space-y-2">
//                 <div className="flex justify-between ">
//                   <p className="text-sm">Payment method</p>
//                   <span className="text-sm font-semibold">Manual transfer</span>
//                 </div>
//                 <div className="flex justify-between">
//                   <p className="text-sm ">Date</p>
//                   <span className="text-sm font-semibold">
//                     22/8/25 - 28/8/25
//                   </span>
//                 </div>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Location</p>
//                   <span className="text-sm font-semibold">Jakarta</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm">Price</p>
//                   <span className="text-sm font-semibold">Rp 2.000.000,00</span>
//                 </p>
//                 <p className="flex justify-between">
//                   <p className="text-sm font-extralight">see more details</p>
//                   <span className="text-sm text-center bg-green-600 w-22 h-5 rounded-md">
//                     Paid
//                   </span>
//                 </p>
//               </div>
//             </div>
//           </div>
//         </div>
//       </div>
//     </>
//   );
// };

// export default OrderList;

// "use client";

// import Image from "next/image";
// import useGetOrders from "../api/useGetOrders";

// const OrderList = () => {
//   const { data, isLoading, isError } = useGetOrders({ page: 1, take: 10 });

//   if (isLoading)
//     return <p className="justify-self-center">Loading orders...</p>;
//   if (isError)
//     return <p className="justify-self-center">Failed to fetch orders</p>;

//   return (
//     <div className="flex flex-col gap-6 py-2">
//       {data?.data.map((order) => (
//         <div
//           key={order.id}
//           className="mx-auto w-full max-w-4xl rounded-2xl border border-gray-200 bg-[#fdfcff] sm:max-w-xl md:max-w-3xl"
//         >
//           {/* Responsive grid: stack on small, 2 columns on md+ */}
//           <div className="grid grid-cols-1 gap-4 px-4 py-6 md:grid-cols-2">
//             {/* Thumbnail */}
//             <div className="relative h-48 w-full overflow-hidden rounded-md md:h-40">
//               <Image
//                 src={order.room.roomImages[0]?.url || "/placeholder.png"}
//                 alt="room images"
//                 fill
//                 className="object-cover"
//               />
//             </div>

//             {/* Order Details */}
//             <div className="flex flex-col justify-between">
//               <div>
//                 <p className="text-xs break-all text-gray-500">
//                   ID {order.uuid}
//                 </p>
//               </div>

//               <div className="mt-2 space-y-3">
//                 {/* <div className="flex justify-between">
//                   <p className="text-sm">Payment method</p>
//                   <span className="text-sm font-semibold">
//                     {order.}
//                   </span>
//                 </div> */}

//                 <div className="flex justify-between">
//                   <p className="text-sm">Date</p>
//                   <span className="text-sm font-semibold">
//                     {new Date(order.startDate).toLocaleDateString()} -{" "}
//                     {new Date(order.endDate).toLocaleDateString()}
//                   </span>
//                 </div>

//                 {/* <div className="flex justify-between">
//                   <p className="text-sm">Location</p>
//                   <span className="text-sm font-semibold">
//                     {order.?.location ?? "-"}
//                   </span>
//                 </div> */}

//                 <div className="flex justify-between">
//                   <p className="text-sm">Price</p>
//                   <span className="text-sm font-semibold">
//                     Rp {order.total.toLocaleString("id-ID")}
//                   </span>
//                 </div>

//                 <div className="flex items-center justify-between">
//                   <p className="cursor-pointer text-sm font-extralight">
//                     see more details
//                   </p>
//                   <span
//                     className={`rounded-md px-3 py-1 text-center text-xs sm:text-sm ${
//                       order.status === "PAID"
//                         ? "bg-green-600 text-white"
//                         : order.status === "WAITING_FOR_PAYMENT"
//                           ? "bg-yellow-500 text-black"
//                           : "bg-gray-400 text-white"
//                     }`}
//                   >
//                     {order.status}
//                   </span>
//                 </div>
//               </div>
//             </div>
//           </div>
//         </div>
//       ))}

//       {data?.data.length === 0 && (
//         <p className="text-center text-gray-500">No orders found</p>
//       )}
//     </div>
//   );
// };

// export default OrderList;

"use client";

import Image from "next/image";
import { useEffect, useState } from "react";
import useGetOrders from "../api/useGetOrders";

const OrderList = () => {
  const { data, isLoading, isError } = useGetOrders({ page: 1, take: 10 });
  const [locations, setLocations] = useState<Record<number, string>>({});

  const getCityName = async (lat: number, lon: number) => {
    try {
      const res = await fetch(
        `https://nominatim.openstreetmap.org/reverse?format=json&lat=${lat}&lon=${lon}`,
      );
      const json = await res.json();
      const addr = json.address;
      return addr.city || addr.town || addr.village || addr.state || "Unknown";
    } catch (err) {
      return "Unknown";
    }
  };

  useEffect(() => {
    if (data?.data) {
      data.data.forEach(async (order) => {
        const city = await getCityName(
          order.room.property.latitute,
          order.room.property.longtitude,
        );
        setLocations((prev) => ({ ...prev, [order.id]: city }));
      });
    }
  }, [data]);

  if (isLoading) return <p className="text-center">Loading orders...</p>;
  if (isError) return <p className="text-center">Failed to fetch orders</p>;

  return (
    <div className="flex flex-col gap-6 py-2">
      {data?.data.map((order) => (
        <div
          key={order.id}
          className="mx-auto w-full max-w-4xl rounded-2xl border border-gray-200 bg-[#fdfcff] sm:max-w-xl md:max-w-3xl"
        >
          <div className="grid grid-cols-1 gap-2 px-8 py-6 md:grid-cols-2">
            {/* Thumbnail */}
            <div className="relative h-55 w-2xs overflow-hidden rounded-md md:h-40">
              <Image
                src={order.room.roomImage[0]?.url || "/placeholder.png"}
                alt="room images"
                fill
                className="object-cover"
              />
            </div>

            <div className="flex flex-col justify-between">
              <p className="text-sm font-bold">
                {order.room.property?.title.toUpperCase() || "Loading..."}
              </p>

              <div className="mt-2 space-y-2">
                {/* Order Details */}

                <p className="text-xs break-all text-gray-500">
                  ID {order.uuid}
                </p>

                <div className="flex justify-between">
                  <p className="text-sm">Date</p>
                  <span className="text-sm font-semibold">
                    {new Date(order.startDate).toLocaleDateString()} -{" "}
                    {new Date(order.endDate).toLocaleDateString()}
                  </span>
                </div>

                <div className="flex justify-between">
                  <p className="text-sm">Location</p>
                  <span className="text-sm font-semibold">
                    {locations[order.id] || "Loading..."}
                  </span>
                </div>

                <div className="flex justify-between">
                  <p className="text-sm">Price</p>
                  <span className="text-sm font-semibold">
                    Rp {order.total.toLocaleString("id-ID")}
                  </span>
                </div>

                <div className="flex items-center justify-between">
                  <p className="cursor-pointer text-sm font-extralight">
                    see more details
                  </p>
                  <span
                    className={`rounded-md px-3 py-1 text-center text-xs sm:text-sm ${
                      order.status === "PAID"
                        ? "bg-green-600 text-white"
                        : order.status === "WAITING_FOR_PAYMENT"
                          ? "bg-yellow-500 text-black"
                          : "bg-gray-400 text-white"
                    }`}
                  >
                    {order.status}
                  </span>
                </div>
              </div>
            </div>
          </div>
        </div>
      ))}

      {data?.data.length === 0 && (
        <p className="text-center text-gray-500">No orders found</p>
      )}
    </div>
  );
};

export default OrderList;
